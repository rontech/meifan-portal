@* UserInfomation Template File *@
@(userForm: Form[User], user: User,  followInfo:FollowInformation)
 @import helper._

@accountField(field: Field, className: String = "account") = {
    @input(field, '_label -> Messages("salon.account"), '_class -> className) { (id, name, value, _) =>
        <input type="text" name="@name" value="@value"> 
        <a class="removeAccount btn danger">@Messages("optContactMethod.Remove")</a>
    }
}

@optContactMethodGroup(field: Field, className: String = "optContactMethod") = {
    <div class="twipsies well @className">
        
        <a class="removeOptContactMethod btn danger pull-right">@Messages("optContactMethod.RemoveOptContactMethod")</a>

        @inputText(
            field("contMethodType"), 
            '_label -> Messages("user.contMethodType")
        )
        
        <div class="accounts">

            @repeat(field("accounts"), min = 0) { account =>
                
                @accountField(account)
    
            }
            
            @**
             * Keep an hidden block that will be used as template for Javascript copy code
             **@
            @accountField(
                field("accounts[x]"),
                className = "account_template"
            )
            
            <div class="clearfix">
                <div class="input">
                    <a class="addAccount btn success">@Messages("optContactMethod.AddNumber")</a>
                </div>
            </div>
        
        </div>
 
    </div>
}

    @myPageMain(navInMyPage = "information", user, followInfo)  {
    	
		<div class="mT10 pH10">
			@form(auth.routes.Users.updateInfo(user.userId), 'id -> "userForm") {
				
				<input type="hidden" name="password" value="@user.password">
				<input type="hidden" name="address.province" value="@user.address.province">
                <input type="hidden" name="address.city" value="@user.address.city">
                <input type="hidden" name="userPics" value="@user.userPics">
                <input type="hidden" name="userTyp" value="@user.userTyp">
                <input type="hidden" name="userBehaviorLevel" value="@user.userBehaviorLevel">
                <input type="hidden" name="point" value="@user.point">
                <input type="hidden" name="permission" value="@user.permission">
                
				<table cellspacing="0" class="wFull bdCell pCell10 bgThNml">
				    <tbody>
				        <tr>
				            <th class="w222">
				                <div class="dibBL vaM w160">
				                    @Messages("user.name")
				                </div>
				            </th>
				            <td>
				               @inputText(userForm("userId"),'_label -> None, 'readonly -> "true")
				            </td>
				        </tr>
				        <tr>
				            <th class="w222">
				                <div class="dibBL vaM w160">
				                    @Messages("user.nickNm")
				                </div>
				            </th>
				            <td>
				               @inputText(userForm("nickName"),'_label -> None, '_error -> userForm("nickName").error.map(_.withMessage(Messages("user.nickNameErr"))))
				            </td>
				        </tr>
				        <tr>
				            <th class="w222">
				                <div class="dibBL vaM w160">
				                    @Messages("user.birthDay")
				                </div>
				            </th>
				            <td>
				               @inputDate(userForm("birthDay"), '_label -> None, '_error -> userForm("birthDay").error.map(_.withMessage(Messages("user.birthDayErr"))))
				            </td>
				        </tr>
				        <tr>
				            <th class="w222">
				                <div class="dibBL vaM w160">
				                    @Messages("user.sex")
				                </div>
				            </th>
				            <td>
				               @inputRadioGroup(userForm("sex"),options = options("M" -> Messages("user.male"), "F" -> Messages("user.female")) , '_label -> None,
                  								'_error -> userForm("sex").error.map(_.withMessage(Messages("user.sexErr"))))
				            </td>
				        </tr>
				        <tr>
				            <th class="w222">
				                <div class="dibBL vaM w160">
				                    @Messages("user.job")
				                </div>
				            </th>
				            <td>
				               @inputText(userForm("socialStatus"),'_label -> None)
				            </td>
				        </tr>
				        <tr>
				            <th class="w222">
				                <div class="dibBL vaM w160">
				                    @Messages("user.email")
				                </div>
				            </th>
				            <td>
				               @inputText(userForm("email"), '_label -> None, '_error -> userForm("email").error.map(_.withMessage(Messages("user.emailErr"))))
				            </td>
				        </tr>
				        <tr>
				            <th class="w222">
				                <div class="dibBL vaM w160">
				                    @Messages("user.tel")
				                </div>
				            </th>
				            <td>
				               @inputText(userForm("tel"), '_label -> None)
				            </td>
				        </tr>
				        <tr>
				            <th class="w222">
				                <div class="dibBL vaM w160">
				                    @Messages("user.tel")
				                </div>
				            </th>
				            <td>
				               @inputDate(userForm("registerTime"),'_label -> "" ,'style -> "display: none")
				            </td>
				        </tr>
				        <tr>
				            <th class="w222">
				                <div class="dibBL vaM w160">
				                    @Messages("salon.address")
				                </div>
				            </th>
				            <td>
				            	@Messages("salon.province"):  <select id="Select1" name = "address.province" value = "@user.address.province"></select>
				                @Messages("salon.city"):  <select id="Select2" name = "address.city" value = "@user.address.city"></select>
				                @Messages("salon.region"):  <select id="Select3" name = "address.region" value = "@user.address.region"></select>
				                <script type="text/javascript">
				                	addressInit('Select1', 'Select2', 'Select3');
				                </script>
				            </td>
				        </tr>
					</tbody>
				</table>
				<table cellspacing="0" class="wFull bdCell pCell10 bgThNml mT10">
				    <tbody>
				        <tr>
				            <th class="w222">
				                <div class="dibBL vaM w160">
				                    @Messages("user.optContactMethod")
				                </div>
				            </th>
				            <td>
				               <div id="optContactMethods">
            
					                @repeat(userForm("optContactMethods")) { optContactMethod =>
					                
					                    @optContactMethodGroup(optContactMethod)
					                
					                }
					                
					                @**
					                 * Keep an hidden block that will be used as template for Javascript copy code
					                 **@
					                @optContactMethodGroup(
					                    userForm("optContactMethods[x]"),
					                    className = "optContactMethod_template"
					                )
					                
					                <div class="manage">
					                    <a class="addOptContactMethod btn success">@Messages("optContactMethod.AddOptContactMethod")</a>
					                </div>
					            
					            </div>
				            </td>
				        </tr>
					</tbody>
				</table>
				
				<div class="mT20 txtC">
					<input type = "submit" class = "buttons" value="@Messages("service.update")">
				</div>
			}
		</div>
        
        <script type="text/javascript" charset="utf-8">
        
        $('.removeOptContactMethod').live('click', function(e) {
            $(this).parents('.optContactMethod').remove()
            renumber()
        })
        
        $('.removeAccount').live('click', function(e) {
            var accounts = $(this).parents('.accounts')
            $(this).parents('.account').remove()
            renumber(accounts)
        })
        
        $('.addAccount').live('click', function(e) {
            var accounts = $(this).parents('.accounts')
            var template = $('.account_template', accounts)
            template.before('<div class="clearfix account">' + template.html() + '</div>')
            renumber(accounts)
        })
        
        $('.addOptContactMethod').live('click', function(e) {
            var template = $('.optContactMethod_template')
            template.before('<div class="twipsies well optContactMethod">' + template.html() + '</div>')
            renumber()
        })
       
        var renumber = function(accounts) {
            $('.optContactMethod').each(function(i) {
                $('input', this).each(function() {
                    $(this).attr('name', $(this).attr('name').replace(/optContactMethods\[.+?\]/g, 'optContactMethods[' + i + ']'))
                })
                $('.account input', this).each(function(i) {
                    $(this).attr('name', $(this).attr('name').replace(/accounts\[.+\]/g, 'accounts[' + i + ']'))
                })
            })
        }
        
    </script>
   

    }
